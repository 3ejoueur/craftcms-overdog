{# LOGIC #}
{% set currentElement = craft.app.urlManager.matchedElement %}
{% set sites = craft.app.getSites().getGroupById(currentSite.groupId).getSites()|without(currentSite) %}
{% set switcherLinks = [] %}
{% set showSwitcherInNav = false %}

{% for site in sites if site.baseUrl is not empty %}

    {% set title = craft.app.i18n.getLocaleById(site.language).displayName() %}
    {% set url = site.getBaseUrl() %}
    {% if currentElement %}
        {% set otherLocaleElement = craft.app.getElements().getElementById(currentElement.id, currentElement.className(), site.id) %}
        {% if otherLocaleElement and otherLocaleElement.enabledForSite %}
            {% set url = otherLocaleElement.url %}
            {% set showSwitcherInNav = true %}
        {% endif %}
    {% endif %}

    {% set switcherLinks = switcherLinks|merge([{
        url: url,
        title: title,
        current: site.id == currentSite.id ? true : false,
        language: site.language,
    }]) %}

{% endfor %}


{# LAYOUT #}
{% if showSwitcherInNav == true %}
  <div class="lang-switch" aria-label="{{'Switch language'|t}}">
  {% for switcherLink in switcherLinks %}
    <a class="lang-switch__link stretched-link" href="{{switcherLink.url}}" hreflang="{{switcherLink.language}}" lang="{{switcherLink.language}}">{{ switcherLink.title [0:2] }}</a>
    {# The bracket after site.name is for Twig slice function to only display the 2 first characters #}
  {% endfor %}
  </div>
{% endif %}
